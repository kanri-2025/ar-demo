<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>設備AR表示デモ</title>
  <!-- 最新の安定バージョンのライブラリを使用 -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    
    /* ローディングインジケーターのスタイル */
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      z-index: 1000;
    }
    
    /* UI要素のスタイル */
    .ar-ui {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 10px;
      color: white;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- ローディングインジケーター -->
  <div id="loading">
    ARを読み込み中...しばらくお待ちください
  </div>
  
  <!-- UI要素 -->
  <div class="ar-ui" id="ar-status">
    カメラを機器に向けてください
  </div>
  
  <!-- A-Frameシーン -->
  <a-scene 
    mindar-image="imageTargetSrc: targets.mind; autoStart: false; maxTrack: 1;" 
    embedded 
    color-space="sRGB" 
    renderer="colorManagement: true; antialias: true"
    vr-mode-ui="enabled: false">
    
    <a-assets></a-assets>
    
    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane position="0 0 0" width="1.5" height="1.0" color="white" opacity="0.9">
        <a-text value="リース料：¥30,000/月\n買取価格：¥1,200,000" 
                position="-0.7 0.2 0.01" 
                color="black" 
                width="2"></a-text>
      </a-plane>
    </a-entity>
    
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
  </a-scene>
  
  <script>
    // ページ読み込み完了後の処理
    document.addEventListener("DOMContentLoaded", () => {
      // ローディング要素とステータス要素
      const loadingElem = document.getElementById('loading');
      const statusElem = document.getElementById('ar-status');
      
      // シーン要素の取得
      const sceneEl = document.querySelector('a-scene');
      
      // ライブラリが正しく読み込まれているか確認
      setTimeout(() => {
        if (window.MINDAR && window.MINDAR.IMAGE) {
          console.log("MindAR is ready and properly loaded");
          
          // ARシステムの開始
          sceneEl.addEventListener('renderstart', () => {
            loadingElem.style.display = 'none';
            console.log("AR system render started");
            
            // 手動でARシステムを開始
            const mindARSystem = sceneEl.systems["mindar-image-system"];
            if (mindARSystem) {
              mindARSystem.start();
              console.log("Manually started MindAR system");
            }
          });
          
          // ターゲット検出イベント
          sceneEl.addEventListener('targetFound', event => {
            console.log("Target found");
            statusElem.textContent = "機器を認識しました！";
          });
          
          // ターゲットロストイベント
          sceneEl.addEventListener('targetLost', event => {
            console.log("Target lost");
            statusElem.textContent = "カメラを機器に近づけてください";
          });
          
        } else {
          console.error("MindAR failed to initialize properly");
          loadingElem.textContent = "エラー: ARライブラリの読み込みに失敗しました";
        }
      }, 1000); // 1秒待機して確認
    });
  </script>
</body>
</html>